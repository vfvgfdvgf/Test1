{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نتائج البحث عن "{{ query }}" - الثَّقَف العربي</title>
    <meta name="description" content="اكتشف نتائج البحث عن '{{ query }}' في منصة الثقافة العربية. مقالات، أقسام، ومعارض ثقافية عربية متنوعة.">
    <meta name="keywords" content="بحث, {{ query }}, ثقافة عربية, مقالات عربية, أقسام ثقافية, معرض ثقافي">
    
    <!-- Open Graph -->
    <meta property="og:title" content="نتائج البحث عن '{{ query }}' - الثَّقَف العربي">
    <meta property="og:description" content="اكتشف نتائج البحث في منصة الثقافة العربية الشاملة">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    <meta property="og:image" content="{% static 'images/og-search.jpg' %}">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="نتائج البحث عن '{{ query }}' - الثَّقَف العربي">
    <meta name="twitter:description" content="اكتشف نتائج البحث في منصة الثقافة العربية">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SearchResultsPage",
        "name": "نتائج البحث عن {{ query }}",
        "description": "صفحة نتائج البحث في منصة الثقافة العربية",
        "url": "{{ request.build_absolute_uri }}",
        "mainEntity": {
            "@type": "ItemList",
            "numberOfItems": {{ articles|length|add:categories|length|add:gallery_items|length }},
            "itemListElement": [
                {% for article in articles %}
                {
                    "@type": "ListItem",
                    "position": {{ forloop.counter }},
                    "item": {
                        "@type": "Article",
                        "name": "{{ article.title|escapejs }}",
                        "url": "{{ request.build_absolute_uri }}{{ article.get_absolute_url }}"
                    }
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]
        }
    }
    </script>   

    <!-- تحميل الخطوط والأيقونات -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Amiri:wght@400;700&family=Almarai:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="{% static 'css/search_results.css' %}">

</head>

<body>
    <!-- رابط تخطي للمحتوى الرئيسي -->
    <a href="#main-content" class="skip-link">انتقل إلى نتائج البحث</a>

    <!-- الهيدر -->
    <header class="header" id="header">
        <div class="container">
            <h1 class="logo">
                <a href="/"><i class="fas fa-feather-alt"></i> الثَّقَف العربي</a>
            </h1>
            
            <!-- نموذج البحث في الهيدر -->
            <form action="{% url 'search' %}" method="get" class="header-search">
                <input type="text" name="q" placeholder="ابحث في الثقافة العربية..." value="{{ query }}" required aria-label="بحث">
                <button type="submit" aria-label="تنفيذ البحث"><i class="fas fa-search"></i></button>
            </form>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="فتح القائمة">
                <i class="fas fa-bars"></i>
            </button>
            
            <nav class="nav" id="nav" aria-label="القائمة الرئيسية">
                <a href="/">الرئيسية</a>
                <a href="/articles/">المقالات</a>
                <a href="/categories/">الأقسام</a>
                <a href="/gallery/">المعرض</a>
                <a href="/about/">من نحن</a>
                <a href="/contact/">اتصل بنا</a>
            </nav>
        </div>
    </header>

    <!-- محتوى صفحة نتائج البحث -->
    <main class="search-results" id="main-content">
        <div class="container">
            <!-- رأس صفحة البحث -->
            <div class="search-results-header">
                <h1 class="search-title">نتائج البحث عن: <span class="query-text">{{ query }}</span></h1>
                
                <div class="search-meta">
                    <p class="results-count">
                        {% if articles or categories or gallery_items %}
                            تم العثور على 
                            <span class="count">{{ articles|length|add:categories|length|add:gallery_items|length }}</span> 
                            نتيجة
                        {% else %}
                            لم يتم العثور على نتائج
                        {% endif %}
                    </p>
                    
                    <div class="search-actions">
                        <button class="filter-btn" id="filterToggle">
                            <i class="fas fa-filter"></i> تصفية النتائج
                        </button>
                        <button class="sort-btn" id="sortToggle">
                            <i class="fas fa-sort"></i> ترتيب حسب
                        </button>
                    </div>
                </div>
            </div>

            <!-- لوحة التحكم -->
            <div class="search-controls" id="searchControls">
                <div class="filters-panel">
                    <h4><i class="fas fa-sliders-h"></i> تصفية حسب النوع</h4>
                    <div class="filter-options">
                        <label class="filter-option">
                            <input type="checkbox" name="content-type" value="articles" checked>
                            <span class="checkmark"></span>
                            المقالات
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="content-type" value="categories" checked>
                            <span class="checkmark"></span>
                            الأقسام
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" name="content-type" value="gallery" checked>
                            <span class="checkmark"></span>
                            المعرض
                        </label>
                    </div>
                </div>
                
                <div class="sort-panel">
                    <h4><i class="fas fa-sort-amount-down"></i> ترتيب حسب</h4>
                    <div class="sort-options">
                        <label class="sort-option">
                            <input type="radio" name="sort" value="relevance" checked>
                            <span class="radio-mark"></span>
                            الأكثر صلة
                        </label>
                        <label class="sort-option">
                            <input type="radio" name="sort" value="newest">
                            <span class="radio-mark"></span>
                            الأحدث
                        </label>
                        <label class="sort-option">
                            <input type="radio" name="sort" value="oldest">
                            <span class="radio-mark"></span>
                            الأقدم
                        </label>
                    </div>
                </div>
            </div>

            <!-- محتوى النتائج -->
            <div class="search-results-content">
                <!-- المقالات -->
                {% if articles %}
                <section class="results-section articles-section" data-type="articles">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-newspaper"></i>
                            المقالات
                            <span class="results-badge">{{ articles|length }}</span>
                        </h2>
                        <a href="{% url 'articles' %}?q={{ query }}" class="view-all-link">
                            عرض الكل <i class="fas fa-arrow-left"></i>
                        </a>
                    </div>
                    
                    <div class="articles-grid">
                        {% for article in articles %}
                        <div class="article-card search-card">
                            <div class="card-content">
                                <div class="card-meta">
                                    <span class="publish-date">
                                        <i class="far fa-calendar"></i>
                                        {{ article.publish_date|date:"d F Y" }}
                                    </span>
                                    {% if article.category %}
                                    <span class="category-tag">
                                        <i class="fas fa-tag"></i>
                                        {{ article.category.name }}
                                    </span>
                                    {% endif %}
                                </div>
                                <h3 class="card-title">
                                    <a href="{% url 'article_detail' article.slug %}">{{ article.title }}</a>
                                </h3>
                                <p class="card-excerpt">{{ article.excerpt|default:article.content|striptags|truncatewords:25 }}</p>
                                <div class="card-actions">
                                    <a href="{% url 'article_detail' article.slug %}" class="read-more-btn">
                                        اقرأ المزيد <i class="fas fa-arrow-left"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
                {% endif %}

                <!-- الأقسام -->
                {% if categories %}
                <section class="results-section categories-section" data-type="categories">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-layer-group"></i>
                            الأقسام
                            <span class="results-badge">{{ categories|length }}</span>
                        </h2>
                        <a href="{% url 'categories' %}" class="view-all-link">
                            عرض الكل <i class="fas fa-arrow-left"></i>
                        </a>
                    </div>
                    
                    <div class="categories-grid">
                        {% for category in categories %}
                        <div class="category-card search-card">
                            <div class="card-content">
                                <div class="card-icon">
                                    {% if category.icon %}
                                        <i class="{{ category.icon }}"></i>
                                    {% else %}
                                        <i class="fas fa-folder"></i>
                                    {% endif %}
                                </div>
                                <h3 class="card-title">
                                    <a href="{% url 'category_detail' category.slug %}">{{ category.name }}</a>
                                </h3>
                                <p class="card-description">{{ category.description|truncatewords:20 }}</p>
                                <div class="category-stats">
                                    <span class="stat">
                                        <i class="fas fa-file-alt"></i>
                                        {{ category.article_count }} مقالة
                                    </span>
                                </div>
                                <a href="{% url 'category_detail' category.slug %}" class="explore-btn">
                                    استكشاف القسم <i class="fas fa-arrow-left"></i>
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
                {% endif %}

                <!-- حالة عدم وجود نتائج -->
                {% if not articles and not categories and not gallery_items %}
                <div class="no-results">
                    <div class="no-results-content">
                        <div class="no-results-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <h3>لم نتمكن من العثور على ما تبحث عنه</h3>
                        <p>حاول استخدام كلمات بحثية أخرى أو تصفح الأقسام المختلفة</p>
                        <div class="search-again">
                            <form action="{% url 'search' %}" method="get" class="search-again-form">
                                <input type="text" name="q" placeholder="جرب بحثاً آخر..." value="{{ query }}">
                                <button type="submit">
                                    <i class="fas fa-search"></i> بحث
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </main>

    <!-- الفوتر -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h5>الثقَف العربي</h5>
                    <p>منصة ثقافية عربية تهدف إلى إثراء المحتوى الثقافي والمعرفي العربي من خلال مقالات وبحوث ومواد متنوعة.</p>
                    <div class="social-links">
                        <a href="#" aria-label="فيسبوك"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="تويتر"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="إنستغرام"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="يوتيوب"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                
                <div class="footer-col">
                    <h5>روابط سريعة</h5>
                    <ul class="footer-links">
                 <li><a href="/cookies/"><i class="fas fa-arrow-left"></i> ملفات تعريف الارتباط </a></li>
                        <li><a href="/privacy/"><i class="fas fa-arrow-left"></i> سياسة الخصوصية</a></li>
                        <li><a href="/terms/"><i class="fas fa-arrow-left"></i> اتفاقية الاستخدام</a></li>
                        <li><a href="/disclaimer/"><i class="fas fa-arrow-left"></i> إخلاء المسؤولية</a></li>
                        <li><a href="/sitemap/"><i class="fas fa-arrow-left"></i> خريطة الموقع</a></li>
                    </ul>
                </div>
                
                <div class="footer-col">
                    <h5>الأقسام</h5>
                    <ul class="footer-links">
                        {% for category in categories|slice:":5" %}
                        <li><a href="{% url 'category_detail' category.slug %}"><i class="fas fa-arrow-left"></i> {{ category.name }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>© 2025 الثَّقَف العربي – جميع الحقوق محفوظة</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript المحسن -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // تأثير التمرير على الهيدر
        const header = document.getElementById('header');
        window.addEventListener('scroll', function() {
            if (window.scrollY > 100) {
                header.classList.add('scrolled');
            } else {
                header.classList.remove('scrolled');
            }
        });

        // القائمة المتنقلة
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const nav = document.getElementById('nav');
        
        if (mobileMenuBtn && nav) {
            mobileMenuBtn.addEventListener('click', function() {
                nav.classList.toggle('active');
                this.innerHTML = nav.classList.contains('active') ? 
                    '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
                this.setAttribute('aria-label', 
                    nav.classList.contains('active') ? 'إغلاق القائمة' : 'فتح القائمة');
            });

            // إغلاق القائمة عند النقر خارجها
            document.addEventListener('click', function(event) {
                if (!nav.contains(event.target) && !mobileMenuBtn.contains(event.target) && nav.classList.contains('active')) {
                    nav.classList.remove('active');
                    mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
                    mobileMenuBtn.setAttribute('aria-label', 'فتح القائمة');
                }
            });
        }

        // التحكم في لوحة التصفية والترتيب
        const filterToggle = document.getElementById('filterToggle');
        const searchControls = document.getElementById('searchControls');
        
        if (filterToggle && searchControls) {
            filterToggle.addEventListener('click', function() {
                searchControls.classList.toggle('active');
                const icon = this.querySelector('i');
                if (searchControls.classList.contains('active')) {
                    icon.classList.replace('fa-filter', 'fa-times');
                } else {
                    icon.classList.replace('fa-times', 'fa-filter');
                }
            });
        }

        // تصفية النتائج
        const filterOptions = document.querySelectorAll('input[name="content-type"]');
        filterOptions.forEach(option => {
            option.addEventListener('change', filterResults);
        });

        function filterResults() {
            const selectedTypes = Array.from(filterOptions)
                .filter(opt => opt.checked)
                .map(opt => opt.value);
            
            document.querySelectorAll('.results-section').forEach(section => {
                const sectionType = section.dataset.type;
                if (selectedTypes.includes(sectionType)) {
                    section.style.display = 'block';
                    // إعادة تشغيل الأنيميشن
                    section.style.animation = 'none';
                    setTimeout(() => {
                        section.style.animation = 'slideInUp 0.6s ease';
                    }, 10);
                } else {
                    section.style.display = 'none';
                }
            });
        }

        // تأثيرات عند التمرير
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // مراقبة العناصر لإضافة تأثيرات
        document.querySelectorAll('.search-card').forEach(card => {
            observer.observe(card);
        });

        // تأثيرات hover متقدمة
        const cards = document.querySelectorAll('.search-card');
        cards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-10px) scale(1.02)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });

        // تأثير كتابة للنص
        const queryText = document.querySelector('.query-text');
        if (queryText) {
            const text = queryText.textContent;
            queryText.textContent = '';
            queryText.style.overflow = 'hidden';
            queryText.style.borderRight = '2px solid var(--accent)';
            queryText.style.animation = 'typewriter 2s steps(40) 1s 1 normal both';
            
            let i = 0;
            const timer = setInterval(() => {
                if (i < text.length) {
                    queryText.textContent += text.charAt(i);
                    i++;
                } else {
                    clearInterval(timer);
                    queryText.style.borderRight = 'none';
                }
            }, 100);
        }

        // تأثيرات النقر على الأزرار
        const buttons = document.querySelectorAll('button, .btn, a[href]');
        buttons.forEach(button => {
            button.addEventListener('click', function(e) {
                // تأثير النقر
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.cssText = `
                    position: absolute;
                    border-radius: 50%;
                    background: rgba(255, 255, 255, 0.6);
                    transform: scale(0);
                    animation: ripple 0.6s linear;
                    pointer-events: none;
                    width: ${size}px;
                    height: ${size}px;
                    left: ${x}px;
                    top: ${y}px;
                `;
                
                this.style.position = 'relative';
                this.style.overflow = 'hidden';
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });

        // تحسين تجربة البحث
        const searchInput = document.querySelector('.header-search input');
        if (searchInput) {
            searchInput.addEventListener('focus', function() {
                this.parentElement.style.transform = 'scale(1.05)';
            });
            
            searchInput.addEventListener('blur', function() {
                this.parentElement.style.transform = 'scale(1)';
            });
        }

        // تحميل سلس للصفحة
        window.addEventListener('load', function() {
            document.body.classList.add('loaded');
        });
    });

    // إضافة أنيميشن الripple
    const style = document.createElement('style');
    style.textContent = `
        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
    `;
    document.head.appendChild(style);
    </script>
</body>
</html>